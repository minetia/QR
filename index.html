<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>정밀 QR 스캐너 v2.6</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { margin: 0; background: #000; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; color: white; }
        #reader-wrapper { position: relative; flex: 1; display: flex; align-items: center; justify-content: center; }
        #reader { width: 100%; height: 100%; }
       .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5; display: flex; flex-direction: column; align-items: center; justify-content: center; }
       .scan-text { margin-bottom: 20px; font-size: 18px; text-shadow: 0 2px 4px #000; }
       .guide-box { width: 250px; height: 250px; border: 2px solid rgba(255,255,255,0.2); border-radius: 30px; position: relative; }
       .corner { position: absolute; width: 40px; height: 40px; border: 4px solid white; border-radius: 10px; }
       .tl { top: -4px; left: -4px; border-right: 0; border-bottom: 0; }
       .tr { top: -4px; right: -4px; border-left: 0; border-bottom: 0; }
       .bl { bottom: -4px; left: -4px; border-right: 0; border-top: 0; }
       .br { bottom: -4px; right: -4px; border-left: 0; border-top: 0; }
       .ui-panel { position: absolute; bottom: 40px; width: 100%; display: flex; flex-direction: column; align-items: center; gap: 20px; z-index: 10; }
       .main-btn { padding: 16px 40px; background: #007bff; border: none; border-radius: 50px; color: white; font-weight: bold; font-size: 18px; box-shadow: 0 4px 15px rgba(0,123,255,0.4); }
       .status { font-size: 14px; color: #ffeb3b; min-height: 20px; }
    </style>
</head>
<body>
    <div id="reader-wrapper">
        <div id="reader"></div>
        <div class="overlay">
            <div class="scan-text" id="guide-text">QR 코드를 가이드 안에 맞춰주세요</div>
            <div class="guide-box">
                <div class="corner tl"></div><div class="corner tr"></div>
                <div class="corner bl"></div><div class="corner br"></div>
            </div>
        </div>
    </div>

    <div class="ui-panel">
        <div id="status" class="status">시스템 준비 완료</div>
        <button id="start-btn" class="main-btn" onclick="startScanner()">스캐너 시작</button>
    </div>

    <script>
        let html5QrCode;
        const statusEl = document.getElementById('status');
        const startBtn = document.getElementById('start-btn');

        async function startScanner() {
            startBtn.style.display = 'none';
            statusEl.innerText = "카메라 장치 찾는 중...";
            
            try {
                // 1. 카메라 목록 가져오기 (사용자 권한 유도) [1]
                const devices = await Html5Qrcode.getCameras();
                if (!devices |

| devices.length === 0) throw new Error("카메라를 찾을 수 없습니다.");

                html5QrCode = new Html5Qrcode("reader");
                
                const config = {
                    fps: 20,
                    qrbox: { width: 250, height: 250 },
                    // [핵심] 안드로이드 크롬의 네이티브 버그 회피를 위해 하드웨어 가속 비활성화
                    experimentalFeatures: { useBarCodeDetectorIfSupported: false }
                };

                // 2. 후면 카메라(environment) 연결 시도
                await html5QrCode.start(
                    { facingMode: "environment" },
                    config,
                    (text) => {
                        if (navigator.vibrate) navigator.vibrate(100);
                        statusEl.innerText = "성공!";
                        alert("인식 결과: " + text);
                    }
                );
                
                statusEl.innerText = "카메라 연결 성공";
                document.getElementById('guide-text').innerText = "QR 코드를 스캔 중입니다...";

            } catch (err) {
                startBtn.style.display = 'block';
                let errorMsg = "실패: ";
                if (err.name === 'NotAllowedError') errorMsg += "카메라 권한을 허용해주세요.";
                else if (err.name === 'NotReadableError') errorMsg += "다른 앱에서 카메라를 사용 중입니다.";
                else errorMsg += err.message |

| "알 수 없는 오류";
                
                statusEl.innerText = errorMsg;
                console.error(err);
            }
        }
    </script>
</body>
</html>
